<!DOCTYPE html>
<html lang="en">
{% load static%}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel='icon' href="static/images/Tjs.jpg">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:ital,wght@0,100..900;1,100..900&amp;family=Playfair+Display:ital,wght@0,400..900;1,400..900&amp;family=Tauri&amp;display=swap" rel="stylesheet">
    <title>{% block title %}TJ HandyMan Service{% endblock %}</title>
    
    {% block css %}
        <link rel="stylesheet" href="{% static 'styles.css' %}">
        <link rel="stylesheet" href="{% static 'navBar.css' %}">
        
    {% endblock %}  
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PHX82QGLW4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-PHX82QGLW4');
</script>
<header class="Header__container">
    <nav class="navbar">
        <div class="logo" style='color:white;'>
            <span style="--i:1;">T</span>
            <span style="--i:2;">J</span>
            <span style="--i:3;">'</span>
            <span style="--i:4;">s</span>
            <span style="--i:5;margin-right:5px"></span>
            <span style="--i:6;">H</span>
            <span style="--i:7;">a</span>
            <span style="--i:8;">n</span>
            <span style="--i:9;">d</span>
            <span style="--i:10;">y</span>
            <span style="--i:11;">m</span>
            <span style="--i:12;">a</span>
            <span style="--i:13;">n</span>
            <span style="--i:14;margin-right:5px"> </span>
            <span style="--i:15;">S</span>
            <span style="--i:16;">e</span>
            <span style="--i:17;">r</span>
            <span style="--i:18;">v</span>
            <span style="--i:19;">i</span>
            <span style="--i:20;">c</span>
            <span style="--i:21;">e</span>
        </div>
        <div class="menu">
            {% if request.user.is_authenticated %}
                {% if request.user.is_staff %}
                    <!-- Admin menu options -->
                    <div class="menu-links" style='font-size:;'>
                        <a href="{% url 'index' %}"><h3 id="index">Home</h3></a>
                        <a href="{% url 'reviews' %}"><h3 id="Review">Reviews</h3></a>
                        <a href="{% url 'gallery' %}"><h3 id="gallery">Gallery</h3></a>
                        <a href="{% url 'create_card' %}"><h3 id="create_card">Create Project</h4></a>
                        <a href="{% url 'admin_page' %}"><h3 id="admin">Admin</h3></a>
                    </div>
                {% else %}
                    <!-- Regular user menu options -->
                    <div class="menu-links">
                        <a href="{% url 'index' %}"><h3 id="index">Home</h3></a>
                        <a href="{% url 'reviews' %}"><h3 id="Review">Reviews</h3></a>
                        <a href="{% url 'gallery' %}"><h3 id="gallery">Gallery</h3></a>
                        <a href="{% url 'request_a_project' %}"><h3 id="request_a_project">Request a Project</h3></a>
                    </div>
                {% endif %}
            {% else %}
                <!-- Non-authenticated user menu options -->
                <div class="menu-links">
                    <a href="{% url 'index' %}"><h3 id="index">Home</h3></a>
                    <a href="{% url 'reviews' %}"><h3 id="Review">Reviews</h3></a>
                    <a href="{% url 'gallery' %}"><h3 id="gallery">Gallery</h3></a>
            
                    {% if request.user.is_authenticated %}
                        {% if request.user.is_staff %}
                            <a href="{% url 'create_card' %}"><h4 id="create_card">Create Project</h4></a>
                            <a href="{% url 'admin_page' %}"><h4 id="admin">Admin</h4></a>
                        {% else %}
                            <a href="{% url 'request_a_project' %}"><h4 id="request_a_project">Request a Project</h4></a>
                        {% endif %}
                    {% endif %}
                </div>
            {% endif %}
        </div>
            <div class="login-signup" >
                {% if user.is_authenticated %}
                    {% comment %} <h2 class='Hi-msg'>Hello {{request.user.username}}</h2> {% endcomment %}
                    <div class="signOutBackground" >
                        <div>
                            <a href="{% url 'signOut' %}" style="text-decoration: none;color: aliceblue;">Sign Out</a>
                        </div>
                    </div>
                    {% else %}
                    <button class="log-in">
                        <a href="{% url 'signIn' %}" style="text-decoration: none;color: white;">Login/Sign-Up</a>
                    </button>
                {% endif %}
            </div>
            {% comment %} <div class="menu-btn">
                <i class="fas fa-bars"></i>
            </div>
            <div class="close-btn">
                <i class="fas fa-times"></i>
            </div> {% endcomment %}
        </div>
    </nav>
    <div class="Header__left">
      <svg class="Header__logo" id="logo" y="0px" viewBox="0 0 483 324" xml:space="preserve">
        <style type="text/css">
          .st0 {
            fill: #FFFFFF;
          }
        </style>

    </div>
    
</header>


<main>
    {% block content %}

    {% endblock %}
    
    <button class='open-btn' onclick='openChatWindow()'><i class='bx bx-message-square-dots'></i> Chat</button>
    <div class="chat-popup" id="chat-form-container">
        <div class="chat-window">
            <div class="card flex-grow-1">
                <div class="card-header bg-primary text-white" style='padding-top:1vw;height:4vw'>
                    <h3 style="font-family:Lato">Chat Window</h3>
                    <span class='close-btn' onclick='closeChatWindow()'>
                    <i class='fa fa-times' style='margin-left:15.8vw;position:relative;top:-2vw;font-size:15pt'></i>
                </span>
                </div>
                
                <div class="card-body messages-box">
                    <ul class="list-unstyled messages-list">
                        <!-- Messages will be dynamically added here -->
                    </ul>
                </div>
                <form class="message-form">
                    {% csrf_token %}
                    <div class="input-group">
                        <textarea class="form-control message-input" placeholder="Type your message..." style='height:15px;position:relative;top:vw'></textarea>
                        <div class="input-group-append">
                            <button type="submit" class="btn btn-primary btn-send" >Send</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        function openChatWindow() {
            document.getElementById('chat-form-container').style.display = "block";
        }
        
        function closeChatWindow() {
            document.getElementById('chat-form-container').style.display = "none";
        }
        const messagesList = document.querySelector('.messages-list');
  const messageForm = document.querySelector('.message-form');
  const messageInput = document.querySelector('.message-input');

  messageForm.addEventListener('submit', async (event) => {
    event.preventDefault();

    const message = messageInput.value.trim();
    if (message.length === 0) {
      return;
    }

    const messageItem = document.createElement('li');
    messageItem.classList.add('message', 'sent');
    messageItem.innerHTML = `
      <div class="message-text">
        <div class="message-sender">
          <b>You</b>
        </div>
        <div class="message-content">
          ${message}
        </div>
      </div>`;
    messagesList.appendChild(messageItem);

    messageInput.value = '';

    try {
      const response = await fetch('{% url 'chatbot' %}', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams({
          'csrfmiddlewaretoken': document.querySelector('[name=csrfmiddlewaretoken]').value,
          'message': message
        })
      });

      if (!response.ok) {
        throw new Error('Failed to send message');
      }

      const data = await response.json();
      const botResponse = data.response;

      const botMessageItem = document.createElement('li');
      botMessageItem.classList.add('message', 'received');
      botMessageItem.innerHTML = `
        <div class="message-text">
          <div class="message-sender">
            <b>Henry (ChatBot)</b>
          </div>
          <div class="message-content">
            ${botResponse}
          </div>
        </div>`;
      messagesList.appendChild(botMessageItem);
    } catch (error) {
      console.error('Error sending message:', error.message);
    }
  });
    </script>


    {% comment %} <div class="main-div">
        <div class="menuToggle">
            <i class='bx bx-hard-hat'></i>
        </div>
        <div class="chatbot_container">
            <div class="top-part">
                <div class='agent-details'>
                <img src='{% static "images/ChatBotPFP.jpg" %}' alt='ChatBot'>
                <div class="agent-text">
                <h3 style='color:white'>HandyHelper</h3>
                <p style='color:white'>ChatBot <span>(Online)</span></p>
            </div>
            <i class='bx bx-x'></i>
        </div>
        <div class='chart-section'>
            <div class="left-part">
                <div class="agent-chart">
                    <img src='{%static "images/ChatBotPFP.jpg"%}'>
                    <p>Hey there! Any questions?</p>
                </div>
            </div>
            <div class="right-part">
                <p>Hello</p>
                <span>20m ago</span>
            </div>
        </div>
        <div class="bottom-section">
            <textarea name="" id="" cols="30" rows="10" placeholder='Send a Message'></textarea>
            <i class='bx bxs-send'></i>
        </div>
    </div>
    <script>
        const menuToggle = document.querySelector('.menuToggle');
        menuToggle.onclick = function(){
            menuToggle.classList.toggle('active')
        }
    </script> {% endcomment %}
</main>
<footer class='footer-distributed'>
        <div class='footer-left'>
            <h3><span>TJ's Handyman Service</span></h3>
            <p class='footer-links'>
                <a href='#'>Home</a>
                |
                <a href='#'>Reviews</a>
                |
                <a href='#'>Gallery</a>
                |
                <a href='#'>Request Project</a>
            </p>
            <p class="footer-company-name">Copyright &copy 2024 <strong>TJ's Handyman Services LLC</strong>
                All rights reserved
            </p>
        </div>
        <div class="footer-center">
            <div>
                <i class="fa fa-map-marker"></i>
                <p><span>Bay St. Louis</span>Mississippi</p>
            </div>
            <div>
                <i class='fa fa-phone'></i>
                <p>+1 228-363-3068</p>
            </div>
            <div>
                <i class='fa fa-envelope'></i>
                <p><a href='mott'>tjhandymanservicellc21@gmail.com</a></p>
            </div>
        </div>
        <div class='footer-right'>
            <p class="footer-company-about">
                <span><b>About the company</b></span>
                <strong>TJ's Handyman Service</strong> is a handyman service
                    where you can meet all of your handyman needs. Assembling,
                    carpentry, and yard work are just a few things TJ has to offer.
            </p>
            <div class="footer-icons">
                <a href='#'><i class='fa fa-facebook'></i></a>
                <a href='#'><i class='fa fa-instagram'></i></a>
            </div>
        </div>
</footer>
{% block javascript %}
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const menuBtn = document.querySelector('.menu-btn');
        const navbar = document.querySelector('.navbar');
        menuBtn.addEventListener('click', function() {
            navbar.classList.toggle('hide-items');
            navbar.classList.toggle('show-links');
        });
    });
</script>
{% endblock %}
</body>
</html>
